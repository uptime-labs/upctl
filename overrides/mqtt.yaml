persistence:
  data:
    enabled: true
    mountPath: /mosquitto/data
    size: 2Gi
    accessMode: ReadWriteOnce
  passwords:
    enabled: true
    type: emptyDir
    mountPath: /etc/mosquitto

service:
  main:
    type: LoadBalancer
    annotations:
      prometheus.io/port: "9234"
      prometheus.io/scrape: "true"
    ports:
      http:
        enabled: true
        port: 8000
      mqtt:
        enabled: true
        port: 1883
      metrics:
        enabled: true
        port: 9234

auth:
  enabled: true

env:
  - name: TZ
    value: "Europe/London" 

initContainers:
  setup-passwords:
    image: "eclipse-mosquitto:2.0.11"
    command: ["sh"]
    args: ["-c", "mosquitto_passwd -b -c /etc/mosquitto/password_file $mqttusername $mqttpassword; mosquitto_passwd -b /etc/mosquitto/password_file $keycloak_mqtt_user $keycloak_mqtt_password"]
    env:
      - name: mqttusername
        value: "user"
      - name: mosquitto_passwd
        value: "password"
      - name: keycloak_mqtt_user
        value: "user"
      - name: keycloak_mqtt_password
        value: "password"
    volumeMounts:
      - mountPath: /etc/mosquitto
        name: passwords

additionalContainers:
  mqtt-exporter:
    image: "sapcc/mosquitto-exporter:0.8.0"
    env:
      - name: BROKER_ENDPOINT
        value: "tcp://localhost:1883"
      - name: MQTT_USER
        value: "user"
      - name: MQTT_PASS
        value: "password"
    ports:
      - name: metrics
        containerPort: 9234
        protocol: TCP
